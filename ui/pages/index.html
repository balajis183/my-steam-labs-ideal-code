<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Blockly Code Generator</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly/blocks.min.js"></script>
    <script src="https://unpkg.com/blockly/javascript.min.js"></script>
    <script src="https://unpkg.com/blockly/python.min.js"></script>
    <script src="https://unpkg.com/blockly/php.min.js"></script>
    <script src="https://unpkg.com/blockly/lua.min.js"></script>
    <script src="https://unpkg.com/blockly/dart.min.js"></script>
    <script src="../../blockly/blocks/index.js"></script>
    <script src="../../blockly/generators/javascript/index.js"></script>
    <script src="../../blockly/generators/python/index.js"></script>
    <script src="../../blockly/generators/cpp/index.js"></script>
    <script src="../../blockly/generators/c/index.js"></script>
    <script type="module" src="../../hardware/pin_io.js"></script>
    <script type="module" src="../../hardware/sensors.js"></script>
    <script type="module" src="../../hardware/oled_display.js"></script>
    <script type="module" src="../../hardware/motor_control.js"></script>
    <script src="../scripts/hardware_adapter.js"></script>
    <link rel="stylesheet" href="../styles/style.css" />
    <link rel="stylesheet" href="../styles/index.css" />
  </head>

  <body>
    <!-- Navbar loaded dynamically -->
    <div id="navbar-placeholder"></div>

    <!-- Toolbar -->
    <div id="topbar">
      <button onclick="generateJavaScriptCode()">Generate JavaScript</button>
      <button onclick="generatePythonCode()">Generate Python</button>
      <button onclick="generateCppCode()">Generate C++</button>
      <button onclick="generateCCode()">Generate C</button>
      <button onclick="copyCode()">Copy Code</button>
      <button onclick="saveBlocksXML()">Save Code</button>
      <button onclick="loadBlocksXML()">Load Code</button>
      <button id="checkConnectionBtn">Check Board Status</button>
      <div id="connection-status" style="width:15px; height:15px; border-radius:50%; background-color:grey; display:inline-block; margin-left:10px;"></div>
    </div>

    <!-- Main container with terminal -->
    <div id="main-container">
      <!-- Main layout -->
      <div id="main">
        <div id="blocklyDiv"></div>
        <div id="codeArea">
          <iframe id="monacoEditor" src="./monaco.html"></iframe>
        </div>
      </div>

      <!-- Terminal Panel -->
      <div id="terminal-panel">
        <div id="terminal-header">
          <span id="terminal-title">Terminal</span>
          <div id="terminal-controls">
            <button class="terminal-btn" onclick="clearTerminal()">Clear</button>
            <button class="terminal-btn" onclick="toggleTerminal()">Hide</button>
          </div>
        </div>
        <div id="terminal-resize-handle"></div>
        <div id="terminal-content">
          <pre id="terminal-output"></pre>
        </div>
      </div>
    </div>

    <!-- Terminal Toggle Button -->
    <button id="terminal-toggle" onclick="toggleTerminal()" title="New: Compile now auto-opens the terminal.">Show Terminal</button>

    <!-- Blockly Toolbox -->
    <xml id="toolbox" style="display: none">
      <category name="Logic" colour="210">
        <block type="controls_if"></block>
        <block type="enhanced_if"></block>
        <block type="logic_compare"></block>
        <block type="enhanced_compare"></block>
        <block type="logic_operation"></block>
        <block type="enhanced_logic"></block>
        <block type="logic_negate"></block>
        <block type="logic_boolean"></block>
      </category>
      <category name="Loops" colour="120">
        <block type="controls_repeat_ext">
          <value name="TIMES">
            <block type="math_number">
              <field name="NUM">10</field>
            </block>
          </value>
        </block>
        <block type="controls_whileUntil"></block>
      </category>
      <category name="Math" colour="230">
        <block type="math_number"></block>
        <block type="math_arithmetic"></block>
      </category>
      <category name="Pin I/O" colour="230">
        <block type="set_pin"></block>
        <block type="read_pin"></block>
        <block type="pin_mode"></block>
        <block type="analog_read"></block>
        <block type="analog_write"></block>
      </category>
      <category name="Motors" colour="20">
        <block type="dc_motor"></block>
        <block type="servo_motor"></block>
        <block type="motor_speed"></block>
      </category>
      <category name="Sensors" colour="120">
        <block type="ldr_sensor"></block>
        <block type="ir_sensor"></block>
        <block type="ir_sensor_analog"></block>
        <block type="temp_sensor"></block>
        <block type="ultrasonic_sensor"></block>
        <block type="touch_sensor"></block>
        <block type="color_sensor"></block>
      </category>
      <category name="Joystick" colour="290">
        <block type="joystick1"></block>
        <block type="joystick2"></block>
      </category>
      <!-- *** COMMUNICATION CATEGORY WITH BLUETOOTH AND WIFI *** -->
      <category name="Communication" colour="290">
        <category name="Bluetooth" colour="290">
          <block type="bluetooth_setup"></block>
          <block type="bluetooth_send"></block>
          <block type="bluetooth_available"></block>
          <block type="bluetooth_read"></block>
        </category>
        <category name="WiFi" colour="290">
          <block type="wifi_connect"></block>
          <block type="wifi_send"></block>
          <block type="wifi_receive"></block>
        </category>
      </category>
      <category name="OLED Display" colour="330">
        <block type="oled_show"></block>
        <block type="oled_show_color"></block>
        <block type="oled_display_variable"></block>
        <block type="oled_display_char"></block>
        <block type="oled_animation_blink"></block>
        <block type="oled_animation_scroll"></block>
      </category>
      <category name="Time" colour="195">
        <block type="time_delay">
          <value name="TIME">
            <block type="math_number">
              <field name="NUM">1000</field>
            </block>
          </value>
        </block>
      </category>
      <category name="My Program" colour="160">
        <block type="my_program"></block>
      </category>
      <category name="Text" colour="160">
        <block type="text"></block>
        <block type="text_print"></block>
      </category>
      <category name="Variables" colour="330">
        <button text="Create variable..." callbackKey="CREATE_VARIABLE"></button>
        <block type="variables_declare">
          <field name="VAR" id="variable_id_1" variabletype="">i_count</field>
        </block>
        <block type="variables_define">
          <field name="VAR" id="variable_id_1" variabletype="">i_count</field>
        </block>
        <block type="math_change">
          <field name="VAR" id="variable_id_1" variabletype="">i_count</field>
          <value name="DELTA">
            <block type="math_number">
              <field name="NUM">1</field>
            </block>
          </value>
        </block>
        <block type="variables_get">
          <field name="VAR" id="variable_id_1" variabletype="">i_count</field>
        </block>
      </category>
      <category name="Functions" colour="290" custom="PROCEDURE"></category>
    </xml>

    <script src="../scripts/blockly_page.js"></script>

    <script src="../scripts/renderer.js"></script>
  </body>
</html>